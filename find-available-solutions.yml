---
# Prepare <foldit> for new scrape
- hosts: localhost
  connection: local
  vars_files:
    - vars/main.yml
  tasks:
    - name: Ensure destination directories exist
      file: path={{ item }} state=directory
      with_items:
        - "{{ available_dir }}"
        - "{{ completed_dir }}"
        - "{{ remaining_dir }}"

    - name: Touch files in case this is a first run
      file: path={{ item[0] }}/{{ item[1] }} state=touch
      with_nested:
        - [ "{{ available_dir }}", "{{ completed_dir }}", "{{ remaining_dir }}"]
        - [ "{{ top_solutions }}", "{{ all_solutions }}" ]

# Find available solutions on <analytics.fold.it>
- hosts: analytics.fold.it
  remote_user: pierce
  vars_files:
    - vars/main.yml
  tasks:
    - name: Find 'top/' solutions
      include: tasks/find_top_solutions.yml
    - name: Find 'all/' solutions
      include: tasks/find_all_solutions.yml

# Create the workload on <foldit>
- hosts: localhost
  connection: local
  vars_files:
    - vars/main.yml
  tasks:
    - include: tasks/create_workload.yml
