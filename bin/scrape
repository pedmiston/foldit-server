#!/usr/bin/env python 
import sys
from pathlib import Path

usage = 'scrape [workload_dir] [workloads_per_push]'

assert len(sys.argv) == 3, 'incorrect number of arguments\n' + usage
workload_dir = Path(sys.argv[1])
assert workload_dir.is_dir(), 'workload dir does not exist\n' + usage
try:
  batches_per_push = int(sys.argv[2])
except Exception as e:
  raise AssertionError('error parsing batches_per_push: {}'.format(e))

for i, workload in enumerate(workload_dir.iterdir()):
    print('ansible-playbook scrape.yml -e workload={workload}'.format(workload=workload))
    if i%batches_per_push == batches_per_push-1:
        print('ansible-playbook push.yml')
