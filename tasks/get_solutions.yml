---
- set_fact:
    workload: "{{ item }}"
    results: "{{ item | splitext | first }}.json"

- name: Copy the workload to the analytics server
  copy: src={{ workload_dir }}/{{ workload }} dest=~/{{ workload }}

- name: Run the puzzle solutions through the parsing script
  script: bin/foldit -o ~/{{ results }} ~/{{ workload }}

- name: Download the data
  fetch: src=~/{{ results }} dest={{ results_dir }}/{{ results }} flat=yes

- name: Delete leftover files on analytics server
  file: path={{ item }} state=absent
  with_items:
    - "~/{{ results }}"
    - "~/{{ workload }}"

- name: Delete workload files on remote machine
  local_action: file path={{ workload_dir }}/{{ workload }} state=absent
